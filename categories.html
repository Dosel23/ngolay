<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ngolay | Categories</title>
  <style>
    body { font-family: sans-serif; margin: 0; background-color: #5a5278; color: #333; }
    /* Header Styles */
    .header { display: flex; justify-content: space-between; align-items: center; background-color: #656283; padding: 10px 40px; color: white; }
    .logo img { width: 80px; height:80px; border-radius: 50%; }
    .nav a { color: white; text-decoration: none; margin: 0 15px; font-weight: bold; transition: 0.3s; }
    .nav a:hover { color: #ddd; }
    .header-icons { display: flex; align-items: center; gap: 15px; }
    .search-container { position: relative; }
    #search-bar { display: none; position: absolute; top: -5px; right: 30px; padding: 5px; border-radius: 5px; border: none; }
    .account-dropdown { position: relative; cursor: pointer; }
    .dropdown-menu { display: none; position: absolute; right: 0; top: 35px; background-color: #222; border-radius: 5px; overflow: hidden; z-index: 10; }
    .dropdown-menu a { display: block; color: white; padding: 10px 20px; text-decoration: none; }
    .dropdown-menu a:hover { background-color: #333; }

    /* Categories Styles */
    .categories { padding: 20px; }
    .categories h2 { color: white; text-align: left; margin-bottom: 20px; margin-left: 20px; }

    .category { position: relative; margin-bottom: 20px; overflow: hidden; border-radius: 8px; height: 150px; }
    .category img { width: 100%; height: 100%; object-fit: cover; display: block; filter: brightness(50%); }
    .category .overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start; padding: 15px 20px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
    .category .overlay .content-wrapper { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .category .overlay h3 { margin: 0; font-size: 2em; }
    .category .overlay .btn { background-color: #ff0000; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; font-size: 0.9em; }

    /* Product Grid */
    .product-grid { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
    .product-card { background: white; color: black; width: calc(25% - 15px); border-radius: 8px; padding: 10px; box-sizing: border-box; text-align: center; }
    .product-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
    .product-card h4 { margin: 10px 0 5px 0; font-size: 1em; }
    .product-card p { margin: 2px 0; font-size: 0.85em; color: #333; }
    .product-card a { display: inline-block; margin-top: 5px; padding: 5px 10px; background: #656283; color: white; text-decoration: none; border-radius: 5px; font-size: 0.85em; }

    /* Footer Styles */
    .footer { background-color: #656283; color: white; padding: 40px; position: relative; }
    .footer-logo { text-align: left; margin-left: 20px; margin-bottom: 20px; }
    .footer-logo img { width: 80px; height: 80px; border-radius: 50%; }
    .footer-links { display: flex; justify-content: center; gap: 60px; margin: 20px 0; }
    .footer-section h3 { margin-bottom: 10px; }
    .footer-section a { display: block; color: white; text-decoration: none; margin: 5px 0; }
    .footer-bottom { border-top: 1px solid #333; margin-top: 20px; padding-top: 10px; color: #aaa; text-align: center; }

    /* Search Results */
    #search-results { display: none; background: white; color: black; position: absolute; top: 35px; right: 0; max-height: 300px; overflow-y: auto; width: 250px; border-radius: 5px; z-index: 20; padding: 5px; }
    #search-results div { padding: 5px; cursor: pointer; border-bottom: 1px solid #ddd; }
    #search-results div:hover { background-color: #eee; }

    /* Responsive */
    @media (max-width: 1024px) { .product-card { width: calc(33.33% - 15px); } }
    @media (max-width: 768px) { .product-card { width: calc(50% - 15px); } }
    @media (max-width: 480px) { .product-card { width: 100%; } }
  </style>
</head>
<body>
<header class="header">
  <div class="logo"><img src="logo.png" alt="Ngolay Logo"></div>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="categories.html" class="active">Categories</a>
    <a href="cart.html">Cart</a>
    <a href="wishlist.html">Wishlist</a>
  </nav>
  <div class="header-icons">
    <div class="search-container">
      <i class="search-icon" id="search-toggle">üîç</i>
      <input type="text" id="search-bar" placeholder="Search products...">
      <div id="search-results"></div>
    </div>
    <div class="account-dropdown">
      <i class="account-icon" id="account-toggle">üë§</i>
      <div class="dropdown-menu" id="account-menu">
        <a href="account.html">Account</a>
        <a href="login.html">Log In</a>
        <a href="logout.html">Log Out</a>
      </div>
    </div>
  </div>
</header>

<section class="categories">
  <h2>Shop by Categories</h2>

  <!-- Categories remain same -->
  <div class="category" data-category="Stationary">
    <img src="stationary.jpg" alt="Stationary">
    <div class="overlay"><div class="content-wrapper"><h3>STATIONARY</h3><a href="stationary.html" class="btn">VIEW ALL</a></div></div>
    <div class="product-grid" id="Stationary-products"></div>
  </div>

  <div class="category" data-category="Clothes">
    <img src="clothes.jpg" alt="Clothes">
    <div class="overlay"><div class="content-wrapper"><h3>CLOTHES</h3><a href="clothes.html" class="btn">VIEW ALL</a></div></div>
    <div class="product-grid" id="Clothes-products"></div>
  </div>

  <div class="category" data-category="Beauty">
    <img src="beauty.jpg" alt="Beauty">
    <div class="overlay"><div class="content-wrapper"><h3>BEAUTY</h3><a href="beauty.html" class="btn">VIEW ALL</a></div></div>
    <div class="product-grid" id="Beauty-products"></div>
  </div>

  <div class="category" data-category="Electronic">
    <img src="electronics.jpg" alt="Electronic">
    <div class="overlay"><div class="content-wrapper"><h3>ELECTRONIC</h3><a href="electronic.html" class="btn">VIEW ALL</a></div></div>
    <div class="product-grid" id="Electronic-products"></div>
  </div>

  <div class="category" data-category="Food">
    <img src="food.jpg" alt="Food">
    <div class="overlay"><div class="content-wrapper"><h3>FOOD</h3><a href="food.html" class="btn">VIEW ALL</a></div></div>
    <div class="product-grid" id="Food-products"></div>
  </div>

  <div class="category" data-category="Miscellanies">
    <img src="miscellanies.jpg" alt="Miscellanies">
    <div class="overlay"><div class="content-wrapper"><h3>MISCELLANIES</h3><a href="miscellanies.html" class="btn">VIEW ALL</a></div></div>
    <div class="product-grid" id="Miscellanies-products"></div>
  </div>
</section>

<footer class="footer">
  <div class="footer-logo"><img src="logo.png" alt="College Market Logo"></div>
  <div class="footer-links">
    <div class="footer-section">
      <h3>Company</h3>
      <a href="about.html">About Us</a>
      <a href="contact.html">Contact</a>
    </div>
    <div class="footer-section">
      <h3>Our Information</h3>
      <a href="terms.html">Terms & Conditions</a>
      <a href="FAQ.html">FAQ</a>
    </div>
  </div>
  <div class="footer-bottom"><p>¬© 2025 Ngolay. All rights reserved.</p></div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCJfAyK_wma5RaTv6DODRgCDExnFuLXK00",
  authDomain: "ngolay-project.firebaseapp.com",
  projectId: "ngolay-project",
  storageBucket: "ngolay-project.appspot.com",
  messagingSenderId: "236457585222",
  appId: "1:236457585222:web:9133bb46a97ef678d23847",
  measurementId: "G-34BC1Z5PPM"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUserUid = null;

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUserUid = user.uid;
  }
});

document.addEventListener('DOMContentLoaded', () => {
  const searchToggle = document.getElementById('search-toggle');
  const searchBar = document.getElementById('search-bar');
  const searchResults = document.getElementById('search-results');
  const accountToggle = document.getElementById('account-toggle');
  const accountMenu = document.getElementById('account-menu');

  // Toggle search bar
  searchToggle.addEventListener('click', () => {
    searchBar.style.display = searchBar.style.display === 'block' ? 'none' : 'block';
    if(searchBar.style.display === 'block') searchBar.focus();
  });

  // Toggle account dropdown
  accountToggle.addEventListener('click', e => {
    e.stopPropagation();
    accountMenu.style.display = accountMenu.style.display === 'block' ? 'none' : 'block';
  });
  document.addEventListener('click', e => {
    if (accountMenu.style.display === 'block' && !accountMenu.contains(e.target) && e.target !== accountToggle) {
      accountMenu.style.display = 'none';
    }
  });

  // Search functionality
  searchBar.addEventListener('input', async () => {
    const query = searchBar.value.trim().toLowerCase();
    searchResults.innerHTML = '';
    if (!query) { searchResults.style.display = 'none'; return; }

    const snapshot = await getDocs(collection(db, "products"));
    const matched = snapshot.docs
      .map(d => ({ id: d.id, ...d.data() }))
      .filter(p => p.name.toLowerCase().includes(query));

    if (matched.length === 0) searchResults.innerHTML = '<div>No products found.</div>';
    else matched.forEach(p => {
      const div = document.createElement('div');
      div.textContent = p.name + " (" + p.category + ")";
      div.addEventListener('click', () => {
        window.location.href = `product_detail.html?id=${p.id}`;
      });
      searchResults.appendChild(div);
    });
    searchResults.style.display = 'block';
  });

  // Load Firestore Products dynamically
  async function loadProducts() {
    const snapshot = await getDocs(collection(db, "products"));
    snapshot.docs.forEach(doc => {
      const product = doc.data();
      const categoryId = product.category + "-products";
      const grid = document.getElementById(categoryId);
      if (grid) {
        const card = document.createElement('div');
        card.className = 'product-card';

        // üîπ Image selection: Base64 support for multiple types
        let imgSrc = 'placeholder.jpg'; // fallback image
        if (product.imageBase64) {
          // Use Base64 field if exists
          imgSrc = `data:image/jpeg;base64,${product.imageBase64}`;
        } else if (product.images && product.images.length > 0) {
          const firstImage = product.images[0];
          if (firstImage.startsWith('data:image')) imgSrc = firstImage; // already Base64
          else imgSrc = firstImage; // URL
        }

        card.innerHTML = `
          <img src="${imgSrc}" alt="${product.name || 'Product'}">
          <h4>${product.name || 'Unnamed Product'}</h4>
          <p>Price: Nu. ${product.price || 'N/A'}</p>
          <p>Quantity: ${product.quantity || 1}</p>
          <p>Size: ${product.size || 'N/A'}</p>
          <p>${product.shortDescription || ''}</p>
          <a href="product_detail.html?id=${doc.id}">View</a>
          <div style="margin-top: 10px;">
            <button class="add-to-cart" data-id="${doc.id}" style="background: #656283; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin: 2px; cursor: pointer;">üõí</button>
            <button class="add-to-wishlist" data-id="${doc.id}" style="background: #ff0000; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin: 2px; cursor: pointer;">‚ù§Ô∏è</button>
          </div>
        `;
        grid.appendChild(card);

        // Add to cart functionality
        card.querySelector('.add-to-cart').addEventListener('click', async (e) => {
          e.preventDefault();
          if (!currentUserUid) {
            alert('Please log in to add to cart!');
            return;
          }
          
          await addDoc(collection(db, "cart"), {
            id: doc.id,
            ...product,
            quantity: 1,
            userId: currentUserUid,
            addedAt: new Date()
          });
          alert(`${product.name} added to cart!`);
        });

        // Add to wishlist functionality
        card.querySelector('.add-to-wishlist').addEventListener('click', async (e) => {
          e.preventDefault();
          if (!currentUserUid) {
            alert('Please log in to add to wishlist!');
            return;
          }
          
          await addDoc(collection(db, "wishlist"), {
            id: doc.id,
            ...product,
            userId: currentUserUid,
            addedAt: new Date()
          });
          alert(`${product.name} added to wishlist!`);
        });
      }
    });
  }

  loadProducts();
});
</script>
</body>
</html>

