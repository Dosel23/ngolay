<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ngolay | Cart</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{background:#f8f9fa;color:#333;}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#656283;color:white;flex-wrap:wrap;}
header .logo img{width:80px;height:80px;border-radius:50%;}
header nav a{color:white;text-decoration:none;margin:0 10px;font-weight:bold;transition:0.3s;}
header nav a:hover{color:#ddd;}
.header-icons{display:flex;align-items:center;gap:15px;position:relative;}
.header-icons input[type=text]{display:none;padding:5px;border-radius:5px;border:none;}
.header-icons .dropdown-menu{display:none;position:absolute;top:40px;right:0;background:white;border:1px solid #ccc;border-radius:5px;min-width:150px;z-index:10;}
.header-icons .dropdown-menu a{display:block;padding:10px;text-decoration:none;color:#333;}
.header-icons .dropdown-menu a:hover{background:#f0f0f0;}

.cart-container{max-width:1200px;margin:auto;padding:20px;}
.cart-container h2{margin-bottom:15px;text-align:center;}

.cart-table-wrapper{overflow-x:auto;}
table{width:100%;border-collapse:collapse;background:white;border-radius:10px;overflow:hidden;min-width:600px;}
th,td{padding:12px;text-align:center;border-bottom:1px solid #ddd;}
th{background:#656283;color:white;}
td img{width:60px;height:60px;object-fit:cover;border-radius:5px;}
td input[type=number], td input[type=text]{padding:5px;border-radius:5px;border:1px solid #ccc;width:90px;}
td button{padding:5px 10px;border:none;border-radius:5px;cursor:pointer;font-weight:bold;}
.remove-btn{background:#dc3545;color:white;}
.remove-btn:hover{background:#c82333;}
.buy-btn{background:#656283;color:white;}
.buy-btn:hover{background:#8C89A6;}
.checkout-all-btn{background:#28a745;color:white;padding:10px 20px;margin-top:20px;border:none;border-radius:5px;cursor:pointer;font-weight:bold;display:block;margin-left:auto;margin-right:auto;}
.checkout-all-btn:hover{background:#218838;}

/* Responsive adjustments */
@media(max-width:768px){
  header{flex-direction:column;align-items:flex-start;}
  header nav{margin-top:10px;}
  .cart-container{padding:10px;}
  th,td{font-size:0.85em;padding:8px;}
  td img{width:50px;height:50px;}
  td input[type=number], td input[type=text]{width:70px;}
  td button{padding:4px 8px;font-size:0.85em;}
}

/* Fully responsive table on small screens */
@media(max-width:480px){
  table, thead, tbody, th, td, tr{display:block;}
  thead tr{display:none;}
  tr{margin-bottom:15px;border-bottom:2px solid #ddd;padding-bottom:10px;}
  td{display:flex;justify-content:space-between;align-items:center;padding:8px;}
  td::before{content:attr(data-label);font-weight:bold;flex:1;text-align:left;}
  td img{width:50px;height:50px;margin-right:10px;}
  td input[type=number], td input[type=text]{width:50px;}
  td button{padding:3px 5px;font-size:0.8em;}
}

.empty-cart{text-align:center;padding:40px;color:#666;font-style:italic;}
</style>
</head>
<body>

<header>
  <div class="logo"><img src="logo.png" alt="Ngolay Logo"></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="categories.html">Categories</a>
    <a href="cart.html" class="active">Cart</a>
    <a href="wishlist.html">Wishlist</a>
  </nav>
  <div class="header-icons">
    <i id="search-toggle">üîç</i>
    <input type="text" id="search-bar" placeholder="Search product...">
    <i id="account-toggle">üë§</i>
    <div class="dropdown-menu" id="account-menu">
      <a href="account.html">Account</a>
      <a href="login.html">Log In</a>
      <a href="logout.html">Log Out</a>
    </div>
  </div>
</header>

<section class="cart-container">
  <h2>My Cart</h2>
  <div class="cart-table-wrapper">
    <table id="cart-table">
      <thead>
        <tr>
          <th>‚úñ</th>
          <th>Item</th>
          <th>Price</th>
          <th>Qty</th>
          <th>Color</th>
          <th>Size</th>
          <th>Buy</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <button id="checkout-all-btn" class="checkout-all-btn">Checkout All Items</button>
</section>

<footer style="text-align:center;padding:20px;background:#656283;color:white;margin-top:20px;">
  ¬© 2025 Ngolay. All Rights Reserved
</footer>

<script type="module">
// Your existing JavaScript code remains exactly the same
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, query, where, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCJfAyK_wma5RaTv6DODRgCDExnFuLXK00",
  authDomain: "ngolay-project.firebaseapp.com",
  projectId: "ngolay-project",
  storageBucket: "ngolay-project.appspot.com",
  messagingSenderId: "236457585222",
  appId: "1:236457585222:web:9133bb46a97ef678d23847"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
let cartItems = [];
const tbody = document.querySelector('#cart-table tbody');
const checkoutAllBtn = document.getElementById('checkout-all-btn');

onAuthStateChanged(auth, async user => {
  if(!user){ 
    alert("Please log in to view your cart");
    window.location.href='login.html'; 
    return; 
  }
  currentUser = user;
  loadCart();
});

async function loadCart(){
  try {
    const cartRef = collection(db, 'cart');
    const q = query(cartRef, where('userId','==',currentUser.uid));
    const snapshot = await getDocs(q);
    cartItems = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
    renderCart();
  } catch (error) {
    console.error("Error loading cart:", error);
    tbody.innerHTML = '<tr><td colspan="7" class="empty-cart">Error loading cart items</td></tr>';
  }
}

function renderCart(){
  tbody.innerHTML = '';
  
  if(cartItems.length === 0){
    tbody.innerHTML='<tr><td colspan="7" class="empty-cart">Your cart is empty. <a href="categories.html">Start shopping</a></td></tr>';
    checkoutAllBtn.style.display = 'none';
    return;
  }
  
  checkoutAllBtn.style.display = 'block';
  
  cartItems.forEach((item, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td data-label="Remove"><button class="remove-btn" data-item-id="${item.id}">‚úñ</button></td>
      <td data-label="Item"><img src="${item.images?.[0]||'logo.png'}" alt="${item.name}"><br>${item.name}</td>
      <td data-label="Price">Nu. ${item.price}</td>
      <td data-label="Qty"><input type="number" min="1" value="${item.quantity||1}" class="quantity-input" data-item-id="${item.id}"></td>
      <td data-label="Color"><input type="text" value="${item.selectedColor||''}" placeholder="Color" class="color-input" data-item-id="${item.id}"></td>
      <td data-label="Size"><input type="text" value="${item.selectedSize||''}" placeholder="Size" class="size-input" data-item-id="${item.id}"></td>
      <td data-label="Buy"><button class="buy-btn" data-item-id="${item.id}">Buy Now</button></td>
    `;
    tbody.appendChild(tr);
  });

  addEventListeners();
}

// All other JavaScript logic (event listeners, checkout, search) remains unchanged
</script>

</body>
</html>
